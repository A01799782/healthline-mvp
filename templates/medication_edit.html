{% extends "base.html" %}
{% block content %}
<a href="{{ url_for('patient_detail', patient_id=patient_id) }}" class="link-plain">&larr; Volver</a>
<div class="card" style="margin-top:12px;">
    <h2 style="margin-top:0;">Editar medicamento</h2>
    {% if error %}<div class="pill pill-danger">{{ error }}</div>{% endif %}
    <form method="post" enctype="multipart/form-data">
        <input type="hidden" name="rxnorm_rxcui" id="rxnorm_rxcui_edit" value="{{ med.rxnorm_rxcui }}">
        <input type="hidden" name="rxnorm_name" id="rxnorm_name_edit" value="{{ med.rxnorm_name }}">
        <label>Nombre</label>
        <input type="text" name="name" id="med_name_edit" value="{{ med.name }}" required>
        <label>Cantidad por toma</label>
        <input type="text" name="dose_value" value="{{ med.dose_value or med.dose or '' }}" required>
        <label>Unidad</label>
        <select name="dose_unit">
            {% set units = ["tableta","c√°psula","mg","g","ml","gotas","inhalaciones","otro"] %}
            {% set current_unit = med.dose_unit or "otro" %}
            {% for u in units %}
            <option value="{{ u }}" {% if u==current_unit %}selected{% endif %}>{{ u }}</option>
            {% endfor %}
        </select>
        <label>Frecuencia (horas)</label>
        <input type="number" name="frequency_hours" min="1" value="{{ med.frequency_hours }}" required>
        <label>Hora inicial</label>
        <input type="datetime-local" name="start_time" value="{{ med.start_time[:16] if med.start_time }}">
        <label>Fecha/hora fin (opcional)</label>
        <input type="datetime-local" name="end_time" value="{{ med.end_time[:16] if med.end_time }}">
        <label>Notas</label>
        <textarea name="notes" rows="3" placeholder="Instrucciones adicionales (opcional)">{{ med.notes }}</textarea>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:12px;">
            <button type="submit">Guardar</button>
            <a href="{{ url_for('patient_detail', patient_id=patient_id) }}" class="link-plain">
                <button type="button" class="btn-ghost">Cancelar</button>
            </a>
        </div>
    </form>
</div>
<script>
(function() {
    const init = function() { window.setupRxnorm("med_name_edit", "rxnorm_rxcui_edit", "rxnorm_name_edit"); };
    if (window.setupRxnorm) { init(); }
    else { window.addEventListener("load", function() { if (window.setupRxnorm) init(); }); }
})();
</script>
{% endblock %}
